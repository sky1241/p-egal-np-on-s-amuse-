<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>MYCELIUM — Test Fermat (1975→2025)</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;700&display=swap');
*{margin:0;padding:0;box-sizing:border-box}
body{background:#08080d;color:#c8ccd4;font-family:'JetBrains Mono',monospace;overflow:hidden;height:100vh}
canvas{position:fixed;top:0;left:0}

#hud{position:fixed;top:20px;left:24px;z-index:10;pointer-events:none}
#hud h1{font-size:20px;color:#e8e8f0;font-weight:300;margin-bottom:2px}
#hud .sub{font-size:9px;color:#3a3a5a;letter-spacing:2px;text-transform:uppercase}

#year-display{position:fixed;top:50%;right:60px;transform:translateY(-50%);z-index:10;pointer-events:none;text-align:right}
#year-display .yr{font-size:72px;font-weight:700;color:#ffffff08;line-height:1}
#year-display .evt{font-size:11px;color:#fb923c;margin-top:8px;max-width:280px;text-align:right;transition:opacity 0.5s}

#stats{position:fixed;bottom:24px;left:24px;z-index:10;pointer-events:none;font-size:10px;line-height:1.8}
#stats .label{color:#3a3a5a}
#stats .val{color:#4ade80}
#stats .warn{color:#f87171}
#stats .bridge{color:#fb923c}

#timeline{position:fixed;bottom:24px;left:50%;transform:translateX(-50%);z-index:10;width:60%;height:4px;background:#1a1a2e;border-radius:2px;cursor:pointer}
#timeline .fill{height:100%;background:linear-gradient(90deg,#4ade80,#fb923c,#f87171);border-radius:2px;transition:width 0.3s}
#timeline .marker{position:absolute;top:-8px;width:2px;height:20px;background:#fb923c80}

#controls{position:fixed;bottom:40px;left:50%;transform:translateX(-50%);z-index:10;display:flex;gap:12px;font-size:10px}
#controls button{background:#1a1a2e;border:1px solid #2a2a4e;color:#888;padding:4px 14px;font-family:inherit;font-size:10px;cursor:pointer;border-radius:3px}
#controls button:hover{border-color:#4ade80;color:#4ade80}
#controls button.active{border-color:#fb923c;color:#fb923c}

#legend{position:fixed;top:24px;right:24px;z-index:10;font-size:9px;pointer-events:none}
#legend div{margin-bottom:6px;display:flex;align-items:center;gap:8px}
#legend .dot{width:8px;height:8px;border-radius:50%;display:inline-block}
</style>
</head>
<body>
<canvas id="c"></canvas>

<div id="hud">
  <h1>MYCELIUM — Test Fermat</h1>
  <div class="sub">Pluie OpenAlex · 1975→2025 · Données réelles</div>
</div>

<div id="year-display">
  <div class="yr" id="yearText">1975</div>
  <div class="evt" id="eventText"></div>
</div>

<div id="stats">
  <div><span class="label">EC (courbes elliptiques) : </span><span class="val" id="sEC">0</span></div>
  <div><span class="label">MF (formes modulaires) : </span><span class="val" id="sMF">0</span></div>
  <div><span class="label">Pont EC↔MF : </span><span class="bridge" id="sBridge">0</span></div>
  <div><span class="label">Triple EC↔MF↔Galois : </span><span class="warn" id="sTriple">0</span></div>
  <div><span class="label">Connexion : </span><span class="bridge" id="sPct">0%</span></div>
  <div style="margin-top:8px"><span class="label">Trou structural : </span><span class="warn" id="sHole">—</span></div>
</div>

<div id="legend">
  <div><span class="dot" style="background:#4ade80"></span> Courbes elliptiques</div>
  <div><span class="dot" style="background:#60a5fa"></span> Formes modulaires</div>
  <div><span class="dot" style="background:#fb923c"></span> Galois</div>
  <div><span class="dot" style="background:#f87171"></span> Pont (co-occurrence)</div>
</div>

<div id="controls">
  <button onclick="speed=0.5">×0.5</button>
  <button onclick="speed=1" class="active">×1</button>
  <button onclick="speed=3">×3</button>
  <button onclick="speed=10">×10</button>
  <button onclick="togglePause()" id="pauseBtn">⏸</button>
</div>

<div id="timeline" onclick="scrub(event)">
  <div class="fill" id="timelineFill"></div>
  <div class="marker" style="left:39.2%"></div>
</div>

<script>
// === REAL DATA FROM OPENALEX ===
const DATA = [
  {year:1975,ec:68,mf:35,ec_mf:2,ec_ga:0,mf_ga:0,triple:0},
  {year:1976,ec:64,mf:45,ec_mf:3,ec_ga:0,mf_ga:0,triple:0},
  {year:1977,ec:73,mf:35,ec_mf:1,ec_ga:0,mf_ga:0,triple:0},
  {year:1978,ec:91,mf:27,ec_mf:1,ec_ga:0,mf_ga:0,triple:0},
  {year:1979,ec:81,mf:33,ec_mf:0,ec_ga:0,mf_ga:0,triple:0},
  {year:1980,ec:80,mf:38,ec_mf:2,ec_ga:0,mf_ga:0,triple:0},
  {year:1981,ec:109,mf:73,ec_mf:5,ec_ga:0,mf_ga:0,triple:0},
  {year:1982,ec:93,mf:68,ec_mf:1,ec_ga:0,mf_ga:0,triple:0},
  {year:1983,ec:125,mf:51,ec_mf:0,ec_ga:0,mf_ga:0,triple:0},
  {year:1984,ec:103,mf:52,ec_mf:2,ec_ga:0,mf_ga:0,triple:0},
  {year:1985,ec:143,mf:72,ec_mf:9,ec_ga:0,mf_ga:0,triple:0},
  {year:1986,ec:173,mf:74,ec_mf:4,ec_ga:0,mf_ga:0,triple:0},
  {year:1987,ec:188,mf:86,ec_mf:4,ec_ga:0,mf_ga:0,triple:0},
  {year:1988,ec:179,mf:72,ec_mf:7,ec_ga:0,mf_ga:0,triple:0},
  {year:1989,ec:192,mf:73,ec_mf:1,ec_ga:0,mf_ga:0,triple:0},
  {year:1990,ec:190,mf:114,ec_mf:8,ec_ga:0,mf_ga:0,triple:1},
  {year:1991,ec:229,mf:77,ec_mf:7,ec_ga:0,mf_ga:0,triple:0},
  {year:1992,ec:250,mf:88,ec_mf:8,ec_ga:0,mf_ga:0,triple:2},
  {year:1993,ec:262,mf:106,ec_mf:3,ec_ga:0,mf_ga:0,triple:0},
  {year:1994,ec:305,mf:112,ec_mf:9,ec_ga:0,mf_ga:0,triple:2},
  {year:1995,ec:299,mf:108,ec_mf:10,ec_ga:0,mf_ga:0,triple:0},
  {year:1996,ec:301,mf:107,ec_mf:11,ec_ga:0,mf_ga:0,triple:0},
  {year:1997,ec:360,mf:167,ec_mf:21,ec_ga:0,mf_ga:0,triple:2},
  {year:1998,ec:358,mf:155,ec_mf:13,ec_ga:0,mf_ga:0,triple:1},
  {year:1999,ec:474,mf:159,ec_mf:14,ec_ga:0,mf_ga:0,triple:1},
  {year:2000,ec:508,mf:183,ec_mf:16,ec_ga:0,mf_ga:0,triple:1},
  {year:2001,ec:555,mf:202,ec_mf:23,ec_ga:0,mf_ga:0,triple:2},
  {year:2002,ec:631,mf:191,ec_mf:14,ec_ga:0,mf_ga:0,triple:0},
  {year:2003,ec:736,mf:253,ec_mf:20,ec_ga:0,mf_ga:0,triple:1},
  {year:2004,ec:884,mf:240,ec_mf:32,ec_ga:0,mf_ga:0,triple:2},
  {year:2005,ec:965,mf:247,ec_mf:28,ec_ga:0,mf_ga:0,triple:1},
  {year:2006,ec:985,mf:315,ec_mf:37,ec_ga:0,mf_ga:0,triple:0},
  {year:2007,ec:1033,mf:283,ec_mf:29,ec_ga:0,mf_ga:0,triple:1},
  {year:2008,ec:1085,mf:313,ec_mf:34,ec_ga:0,mf_ga:0,triple:1},
  {year:2009,ec:1111,mf:343,ec_mf:26,ec_ga:0,mf_ga:0,triple:0},
  {year:2010,ec:1160,mf:419,ec_mf:36,ec_ga:0,mf_ga:0,triple:0},
  {year:2011,ec:1245,mf:435,ec_mf:41,ec_ga:0,mf_ga:0,triple:0},
  {year:2012,ec:1263,mf:467,ec_mf:53,ec_ga:0,mf_ga:0,triple:1},
  {year:2013,ec:1254,mf:543,ec_mf:50,ec_ga:0,mf_ga:0,triple:0},
  {year:2014,ec:1242,mf:488,ec_mf:32,ec_ga:0,mf_ga:0,triple:2},
  {year:2015,ec:1253,mf:505,ec_mf:46,ec_ga:0,mf_ga:0,triple:0},
  {year:2016,ec:1218,mf:554,ec_mf:53,ec_ga:0,mf_ga:0,triple:2},
  {year:2017,ec:1136,mf:512,ec_mf:39,ec_ga:0,mf_ga:0,triple:0},
  {year:2018,ec:1232,mf:539,ec_mf:42,ec_ga:0,mf_ga:0,triple:0},
  {year:2019,ec:1210,mf:535,ec_mf:44,ec_ga:0,mf_ga:0,triple:0},
  {year:2020,ec:1330,mf:580,ec_mf:45,ec_ga:0,mf_ga:0,triple:2},
  {year:2021,ec:1231,mf:611,ec_mf:43,ec_ga:0,mf_ga:0,triple:1},
  {year:2022,ec:1191,mf:622,ec_mf:52,ec_ga:0,mf_ga:0,triple:1},
  {year:2023,ec:1150,mf:597,ec_mf:46,ec_ga:0,mf_ga:0,triple:0},
  {year:2024,ec:966,mf:326,ec_mf:13,ec_ga:0,mf_ga:0,triple:0},
  {year:2025,ec:1010,mf:510,ec_mf:52,ec_ga:0,mf_ga:0,triple:1},
];

const EVENTS = {
  1975: "",
  1985: "Frey: si Fermat faux → courbe elliptique bizarre",
  1986: "Ribet prouve: Taniyama-Shimura → Fermat",
  1990: "Premier TRIPLE paper (1 seul en 15 ans)",
  1993: "Wiles annonce sa preuve (juin)",
  1994: "Gap trouvé dans la preuve...",
  1995: "Wiles + Taylor: preuve complète ✓",
  1997: "Explosion post-Wiles: 21 ponts EC↔MF",
  2001: "Breuil-Conrad-Diamond-Taylor: Taniyama-Shimura complet",
};

// === CANVAS SETUP ===
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
let W, H;
function resize() { W = canvas.width = innerWidth; H = canvas.height = innerHeight; }
resize();
addEventListener('resize', resize);

// === NETWORK NODES ===
// Three clusters: EC (green, left), MF (blue, right), Galois (orange, top)
const nodes = [];
const edges = [];
const particles = [];

function initNodes() {
  nodes.length = 0;
  
  // EC cluster - left
  const ecCx = W * 0.28, ecCy = H * 0.55;
  for (let i = 0; i < 40; i++) {
    const a = (i / 40) * Math.PI * 2 + Math.random() * 0.3;
    const r = 30 + Math.random() * 120;
    nodes.push({
      x: ecCx + Math.cos(a) * r, y: ecCy + Math.sin(a) * r,
      ox: ecCx + Math.cos(a) * r, oy: ecCy + Math.sin(a) * r,
      type: 'ec', r: 2 + Math.random() * 3, phase: Math.random() * 6.28
    });
  }
  
  // MF cluster - right
  const mfCx = W * 0.72, mfCy = H * 0.55;
  for (let i = 0; i < 30; i++) {
    const a = (i / 30) * Math.PI * 2 + Math.random() * 0.3;
    const r = 25 + Math.random() * 100;
    nodes.push({
      x: mfCx + Math.cos(a) * r, y: mfCy + Math.sin(a) * r,
      ox: mfCx + Math.cos(a) * r, oy: mfCy + Math.sin(a) * r,
      type: 'mf', r: 2 + Math.random() * 3, phase: Math.random() * 6.28
    });
  }
  
  // Galois cluster - top center
  const gaCx = W * 0.50, gaCy = H * 0.22;
  for (let i = 0; i < 20; i++) {
    const a = (i / 20) * Math.PI * 2 + Math.random() * 0.3;
    const r = 20 + Math.random() * 70;
    nodes.push({
      x: gaCx + Math.cos(a) * r, y: gaCy + Math.sin(a) * r,
      ox: gaCx + Math.cos(a) * r, oy: gaCy + Math.sin(a) * r,
      type: 'ga', r: 2 + Math.random() * 2.5, phase: Math.random() * 6.28
    });
  }
}

// === SIMULATION STATE ===
let currentIdx = 0;
let t = 0;
let speed = 1;
let paused = false;
let bridgeEdges = [];
let cumEC = 0, cumMF = 0, cumBridge = 0, cumTriple = 0;

function togglePause() {
  paused = !paused;
  document.getElementById('pauseBtn').textContent = paused ? '▶' : '⏸';
}

function scrub(e) {
  const rect = e.target.getBoundingClientRect();
  const pct = (e.clientX - rect.left) / rect.width;
  currentIdx = Math.floor(pct * DATA.length);
  recalcState();
}

function recalcState() {
  cumEC = 0; cumMF = 0; cumBridge = 0; cumTriple = 0;
  bridgeEdges = [];
  for (let i = 0; i <= currentIdx && i < DATA.length; i++) {
    const d = DATA[i];
    cumEC += d.ec;
    cumMF += d.mf;
    cumBridge += d.ec_mf;
    cumTriple += d.triple;
    
    // Create bridge edges proportional to ec_mf
    const bridgeCount = Math.min(d.ec_mf, 8);
    for (let b = 0; b < bridgeCount; b++) {
      const ecNode = nodes[Math.floor(Math.random() * 40)];
      const mfNode = nodes[40 + Math.floor(Math.random() * 30)];
      bridgeEdges.push({
        x1: ecNode.ox, y1: ecNode.oy,
        x2: mfNode.ox, y2: mfNode.oy,
        alpha: 0.1 + (d.ec_mf / 53) * 0.4,
        year: d.year,
        isTriple: false
      });
    }
    
    if (d.triple > 0) {
      const gaNode = nodes[70 + Math.floor(Math.random() * 20)];
      const ecNode = nodes[Math.floor(Math.random() * 40)];
      const mfNode = nodes[40 + Math.floor(Math.random() * 30)];
      bridgeEdges.push({x1:ecNode.ox,y1:ecNode.oy,x2:gaNode.ox,y2:gaNode.oy,alpha:0.8,year:d.year,isTriple:true});
      bridgeEdges.push({x1:mfNode.ox,y1:mfNode.oy,x2:gaNode.ox,y2:gaNode.oy,alpha:0.8,year:d.year,isTriple:true});
    }
  }
}

const colors = { ec: '#4ade80', mf: '#60a5fa', ga: '#fb923c', bridge: '#f87171', triple: '#fbbf24' };

function drawNode(n, time) {
  const pulse = 1 + Math.sin(time * 2 + n.phase) * 0.15;
  const r = n.r * pulse;
  
  // Glow
  const grad = ctx.createRadialGradient(n.x, n.y, 0, n.x, n.y, r * 4);
  const col = colors[n.type];
  grad.addColorStop(0, col + '40');
  grad.addColorStop(1, col + '00');
  ctx.fillStyle = grad;
  ctx.beginPath();
  ctx.arc(n.x, n.y, r * 4, 0, Math.PI * 2);
  ctx.fill();
  
  // Core
  ctx.fillStyle = col;
  ctx.beginPath();
  ctx.arc(n.x, n.y, r, 0, Math.PI * 2);
  ctx.fill();
}

function drawBridgeEdge(e, time) {
  if (e.isTriple) {
    ctx.strokeStyle = colors.triple + Math.floor(e.alpha * 255).toString(16).padStart(2, '0');
    ctx.lineWidth = 2;
    ctx.shadowColor = colors.triple;
    ctx.shadowBlur = 12;
  } else {
    ctx.strokeStyle = colors.bridge + Math.floor(e.alpha * 200).toString(16).padStart(2, '0');
    ctx.lineWidth = 0.8;
    ctx.shadowColor = 'transparent';
    ctx.shadowBlur = 0;
  }
  
  // Organic curve
  const mx = (e.x1 + e.x2) / 2 + Math.sin(time + e.x1) * 20;
  const my = (e.y1 + e.y2) / 2 + Math.cos(time + e.y1) * 15;
  
  ctx.beginPath();
  ctx.moveTo(e.x1, e.y1);
  ctx.quadraticCurveTo(mx, my, e.x2, e.y2);
  ctx.stroke();
  ctx.shadowBlur = 0;
}

function drawIntraEdges(time) {
  ctx.strokeStyle = '#ffffff06';
  ctx.lineWidth = 0.5;
  
  // EC internal
  for (let i = 0; i < 40; i++) {
    for (let j = i + 1; j < 40; j++) {
      const dx = nodes[i].ox - nodes[j].ox;
      const dy = nodes[i].oy - nodes[j].oy;
      if (dx * dx + dy * dy < 8000) {
        ctx.beginPath();
        ctx.moveTo(nodes[i].x, nodes[i].y);
        ctx.lineTo(nodes[j].x, nodes[j].y);
        ctx.stroke();
      }
    }
  }
  // MF internal
  for (let i = 40; i < 70; i++) {
    for (let j = i + 1; j < 70; j++) {
      const dx = nodes[i].ox - nodes[j].ox;
      const dy = nodes[i].oy - nodes[j].oy;
      if (dx * dx + dy * dy < 6000) {
        ctx.beginPath();
        ctx.moveTo(nodes[i].x, nodes[i].y);
        ctx.lineTo(nodes[j].x, nodes[j].y);
        ctx.stroke();
      }
    }
  }
  // GA internal
  for (let i = 70; i < 90; i++) {
    for (let j = i + 1; j < 90; j++) {
      const dx = nodes[i].ox - nodes[j].ox;
      const dy = nodes[i].oy - nodes[j].oy;
      if (dx * dx + dy * dy < 5000) {
        ctx.beginPath();
        ctx.moveTo(nodes[i].x, nodes[i].y);
        ctx.lineTo(nodes[j].x, nodes[j].y);
        ctx.stroke();
      }
    }
  }
}

// Spore particles
function spawnParticles(d) {
  const count = Math.floor((d.ec + d.mf) / 80);
  for (let i = 0; i < count; i++) {
    particles.push({
      x: Math.random() * W,
      y: -10,
      vy: 0.3 + Math.random() * 0.8,
      life: 1,
      type: Math.random() < 0.6 ? 'ec' : 'mf'
    });
  }
}

function updateParticles() {
  for (let i = particles.length - 1; i >= 0; i--) {
    const p = particles[i];
    p.y += p.vy;
    p.life -= 0.003;
    if (p.life <= 0 || p.y > H) particles.splice(i, 1);
  }
}

function drawParticles() {
  for (const p of particles) {
    ctx.fillStyle = (p.type === 'ec' ? '#4ade80' : '#60a5fa') + Math.floor(p.life * 40).toString(16).padStart(2, '0');
    ctx.fillRect(p.x, p.y, 1, 2);
  }
}

// Cluster labels
function drawLabels() {
  ctx.font = '11px JetBrains Mono';
  ctx.textAlign = 'center';
  
  ctx.fillStyle = '#4ade8060';
  ctx.fillText('COURBES ELLIPTIQUES', W * 0.28, H * 0.55 + 150);
  
  ctx.fillStyle = '#60a5fa60';
  ctx.fillText('FORMES MODULAIRES', W * 0.72, H * 0.55 + 130);
  
  ctx.fillStyle = '#fb923c60';
  ctx.fillText('GALOIS', W * 0.50, H * 0.22 - 95);
  
  // Hole indicator
  if (currentIdx < DATA.length) {
    const d = DATA[currentIdx];
    const pct = d.ec + d.mf > 0 ? d.ec_mf / (d.ec + d.mf) * 100 : 0;
    if (pct < 3) {
      ctx.font = '14px JetBrains Mono';
      ctx.fillStyle = '#f8717180';
      const cx = W * 0.50, cy = H * 0.48;
      ctx.fillText('▼ TROU STRUCTURAL ▼', cx, cy);
      
      // Pulsing void indicator
      const voidR = 40 + Math.sin(t * 3) * 10;
      ctx.strokeStyle = '#f8717130';
      ctx.lineWidth = 1;
      ctx.setLineDash([4, 8]);
      ctx.beginPath();
      ctx.ellipse(cx, cy + 20, voidR * 3, voidR, 0, 0, Math.PI * 2);
      ctx.stroke();
      ctx.setLineDash([]);
    }
  }
}

// === UPDATE HUD ===
function updateHUD() {
  if (currentIdx >= DATA.length) return;
  const d = DATA[currentIdx];
  
  document.getElementById('yearText').textContent = d.year;
  document.getElementById('yearText').style.color = d.year === 1995 ? '#fb923c20' : '#ffffff08';
  
  const evt = EVENTS[d.year] || '';
  document.getElementById('eventText').textContent = evt;
  document.getElementById('eventText').style.opacity = evt ? 1 : 0;
  
  document.getElementById('sEC').textContent = cumEC.toLocaleString();
  document.getElementById('sMF').textContent = cumMF.toLocaleString();
  document.getElementById('sBridge').textContent = cumBridge.toLocaleString();
  document.getElementById('sTriple').textContent = cumTriple.toLocaleString();
  
  const pct = cumEC + cumMF > 0 ? (cumBridge / (cumEC + cumMF) * 100).toFixed(2) : '0';
  document.getElementById('sPct').textContent = pct + '%';
  
  const hole = d.ec_mf < 5 ? 'BÉANT ●' : d.ec_mf < 15 ? 'VISIBLE ◐' : d.ec_mf < 30 ? 'SE REMPLIT ◑' : 'DENSE ○';
  const holeEl = document.getElementById('sHole');
  holeEl.textContent = hole;
  holeEl.style.color = d.ec_mf < 5 ? '#f87171' : d.ec_mf < 15 ? '#fb923c' : d.ec_mf < 30 ? '#fbbf24' : '#4ade80';
  
  document.getElementById('timelineFill').style.width = ((currentIdx / DATA.length) * 100) + '%';
}

// === MAIN LOOP ===
let lastAdvance = 0;

function frame(now) {
  requestAnimationFrame(frame);
  
  const dt = 1/60;
  if (!paused) t += dt * speed;
  
  // Advance year
  if (!paused && now - lastAdvance > 2000 / speed && currentIdx < DATA.length - 1) {
    currentIdx++;
    recalcState();
    spawnParticles(DATA[currentIdx]);
    lastAdvance = now;
  }
  
  // Animate nodes
  for (const n of nodes) {
    n.x = n.ox + Math.sin(t * 0.5 + n.phase) * 3;
    n.y = n.oy + Math.cos(t * 0.7 + n.phase * 1.3) * 2;
  }
  
  updateParticles();
  
  // === DRAW ===
  ctx.clearRect(0, 0, W, H);
  
  // Background gradient
  const bg = ctx.createRadialGradient(W/2, H/2, 0, W/2, H/2, W * 0.7);
  bg.addColorStop(0, '#0d0d18');
  bg.addColorStop(1, '#08080d');
  ctx.fillStyle = bg;
  ctx.fillRect(0, 0, W, H);
  
  drawIntraEdges(t);
  
  // Bridge edges (the mycelium growing between clusters)
  const visibleEdges = bridgeEdges.filter(e => {
    const idx = DATA.findIndex(d => d.year === e.year);
    return idx <= currentIdx;
  });
  for (const e of visibleEdges) drawBridgeEdge(e, t);
  
  drawParticles();
  for (const n of nodes) drawNode(n, t);
  drawLabels();
  updateHUD();
}

// === INIT ===
initNodes();
recalcState();
requestAnimationFrame(frame);
</script>
</body>
</html>
